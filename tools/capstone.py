from capstone import *
from rich.syntax import Syntax
from config.colours import exception_error, console


def disassemble(pe, disassembler):
    """Disassembles PE into asm"""
    try:
        print("")
        entrypoint = pe.OPTIONAL_HEADER.AddressOfEntryPoint 
        entrypoint_address = entrypoint + pe.OPTIONAL_HEADER.ImageBase
        binary_code = pe.get_memory_mapped_image()[entrypoint:entrypoint+200]

        for instruction in disassembler.disasm(binary_code, entrypoint_address):
            syntax = Syntax(
                (instruction.mnemonic + "\t" + instruction.op_str),
                "asm",
                tab_size=4,
            )
            console.print(syntax)
        print("")

    except Exception as e:
        exception_error(e)
